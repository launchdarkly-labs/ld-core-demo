apiVersion: apps/v1
kind: Deployment
metadata:
  name: ld-core-demo-deployment
  labels:
    app: ld-core-demo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ld-core-demo
  template:
    metadata:
      labels:
        app: ld-core-demo
    spec:
      containers:
        - name: ld-core-demo
          image: placeholder4
          ports:
            - name: web
              containerPort: 3000
              protocol: TCP
          imagePullPolicy: Always
          env:
            - name: AWS_DEFAULT_REGION
              valueFrom:
                secretKeyRef:
                  name: placeholder2
                  key: AWS_DEFAULT_REGION
            - name: ENABLE_IRP
              value: "true"
            - name: DB_URL
              valueFrom:
                secretKeyRef:
                  name: placeholder2
                  key: DB_URL

---
apiVersion: v1
kind: Service
metadata:
  name: placeholder1
spec:
  selector:
    app: ld-core-demo
  ports:
    - protocol: TCP
      port: 443
      targetPort: 3000
  type: NodePort
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ld-core-demo-ingress
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/group.name: ld-core-demo-lb
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS": 443}]'
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-1:955116512041:certificate/fa29cb5d-f635-40df-89cc-70db82c93845
spec:
  ingressClassName: alb
  rules:
    - host: placeholder2
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: placeholder3
                port:
                  number: 443
---
apiVersion: v1
kind: Secret
metadata:
  name: placeholder3
  namespace: placeholder3
type: Opaque
data:
  DB_URL: cG9zdGdyZXNxbDovL3Bvc3RncmVzOkxERDN2M3hwQGZpZWxkZGVtb2RiLmNpaTN2aWU3bmFvZS51cy13ZXN0LTIucmRzLmFtYXpvbmF3cy5jb206NTQzMg==
  AWS_DEFAULT_REGION: dXMtd2VzdC0y
---